<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2019-nCov</title>
<script src="https://raw.githubusercontent.com/Stuk/jszip/master/dist/jszip.min.js">
/*
function decompressZip(file_blob) {
  var zip = new JSZip();
  zip.loadAsync(file_blob) {
     .then(function(zip) {
         // process ZIP file content here
         alert("OK")
     }, function() {alert("Not a valid zip file")});
  };
}
*/
</script>
<script src="algos.js"></script>
<script src="parsers.js"></script>
<script src="test.js"></script>
<script src="utils.js"></script>

<script>
function loadServerKml(path) {
  var req = new XMLHttpRequest();
  req.open("GET", path, false);
  req.setRequestHeader("Content-Type", "text/xml");
  req.send(null);
  var kml_text = req.response;
  return parseKml(kml_text);
}

function loadPatientData() {
  var points = loadServerKml("kml/Diamond.kml");
  document.getElementById("file_content").innerHTML = JSON.stringify(points).split("},{").join("},\n{");//FIXME
}

function loadFileContent(file_blob) {
  console.log(file_blob);
  var filename = file_blob.name;
  if (filename.endsWith(".kml")) {
    var oReader = new FileReader();
    oReader.onload = function(fp){
      var kml_text = fp.target.result;
      var points = parseKml(kml_text);
      document.getElementById("file_content").innerHTML = JSON.stringify(points);
    };
    oReader.readAsText(file_blob, "UTF-8");
  } else {
    alert("Not supported file type: " + filename);
  }
}

function updateSize() {
  let nBytes = 0,
      oFiles = document.getElementById("uploadInput").files,
      nFiles = oFiles.length;
  for (let nFileId = 0; nFileId < nFiles; nFileId++) {
    nBytes += oFiles[nFileId].size;
    loadFileContent(oFiles[nFileId]);
  }
  let sOutput = nBytes + " bytes";
  // optional code for multiples approximation
  for (let aMultiples = ["KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"], nMultiple = 0, nApprox = nBytes / 1024; nApprox > 1; nApprox /= 1024, nMultiple++) {
    sOutput = nApprox.toFixed(3) + " " + aMultiples[nMultiple] + " (" + nBytes + " bytes)";
  }
  // end of optional code
  document.getElementById("fileNum").innerHTML = nFiles;
  document.getElementById("fileSize").innerHTML = sOutput;
}

</script>
</head>

<body onload="updateSize(); loadPatientData();">
<form name="uploadForm">
Select a local file to test.
<p><input id="uploadInput" type="file" name="myFiles" onchange="updateSize();" multiple> selected files: <span id="fileNum">0</span>; total size: <span id="fileSize">0</span></p>
<hr>
File content:
<pre id=file_content></pre>
</form>
</body>
</html>

